<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="css/screen.css" />
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link rel="shortcut icon" href="favicon.ico" type=
  "image/x-icon" />

  <title>Macros</title>
</head>

<body>
<div id="content">
  <h1><a name="macros_top" id="macros_top">Macros</a></h1>

  <p>Macros are scripts which automate Komodo. They are stored  <a
  class="doc" href="toolbox.html#toolbox_top">toolboxes</a> and can be
  launched by double-clicking the macro icon, pressing an associated <a
  href="#key_bindings">custom key binding</a>, or by binding them to
  event <a class="doc" href="#triggers_macros">triggers</a>.</p>
  
  <p>The <strong>Macros</strong> toolbar provides quick access for
  recording, running, and saving macros. To show or hide the
  toolbar, select <strong>View|Toolbars|Macros</strong>.
  You can also use the <strong>Tools|Macros</strong> menu items.</p>

  <h2><a name="creating_macros" id="creating_macros">Creating Macros</a></h2>

  <p>Macros can be created by recording keystroke and command sequences,
  or written from scratch in JavaScript or Python using the <a
  href="macroapi.html#macroapi_top">Macro API</a>.</p>
  
  <h3><a name="macros_recording" id="macros_recording">Recording Macros</a></h3>

  <p>Recording is a simple method for creating a macro. Only keystrokes
  (not mouse movements) are recorded.</p>
  
  <p>To record a macro:</p>

  <ol>
    <li>Select <strong>Tools|Macros|Start Recording</strong> (or use the
    <strong>Record Macro</strong> button in the Macro toolbar). The
    Komodo status bar displays "Recording Macro".</li>

    <li>In the Editor Pane, enter the keystrokes to store in the
    macro. While entering keystrokes, pause recording by selecting
    <strong>Tools|Macros|Pause Recording</strong>. Select
    <strong>Start Recording</strong> when ready to resume macro
    creation.</li>

    <li>To end macro recording, select <strong>Tools|Macros|Stop
    Recording</strong>. The status bar displays "Macro
    Recorded".</li>
  </ol>
  
  <p><strong>Note</strong>: Though keystrokes in the Editor pane can
  be captured and recorded in this manner, several Komodo commands
  cannot. If your resulting macro does not replay certain operations,
  you may be able to add them manually by editing the recorded macro.
  Consult the <a href="#macros_writing">Writing Macros</a> section
  in conjunction with the <a href="commandid.html">Command ID List</a>
  and the <a href="macroapi.html#macroapi_top">Macro API</a> for further
  information.</p>

  <p>To save the most recent macro:</p>

  <ol>
    <li>Select <strong>Tools|Macros|Save to Toolbox</strong>, or
    click <strong>Macro: Save to Toolbox</strong> on the Macro
    Toolbar.</li>

    <li>Give the new macro a unique name in the <strong>Enter name
    for new macro</strong> field. A reference to the macro is
    automatically added to the <a class="doc" href=
    "toolbox.html#toolbox_top">Toolbox</a>.</li>
  </ol>

  <h3><a name="macros_writing" id="macros_writing">Writing Macros</a></h3>

  <p>Use the "New Macro" Properties dialog box to write macros in either
  Python or JavaScript. This dialog box has tabs for specifying <a
  class="doc" href="#key_bindings">key bindings</a> and Komodo event <a
  class="doc" href="#triggers_macros">triggers</a> that invoke the macro
  automatically.</p>

  <p>To add a macro:</p>

  <ol>
    <li>Select <strong>Add New Macro...</strong> from the Toolbox
    drop-down menu or a folder's right-click context menu.</li>
    
    <li><strong>Language</strong>: Specify the language (Python or
    JavaScript) in which to program the macro.</li>

    <li>Set any desired <a href="#macros_properties">macro
    properties</a>.</li>

    <li>Write the macro in the editor field or save what you have so far
    by clicking <strong>OK</strong>. You can open it in an editor tab by
    right-clicking on the macro icon and selecting <strong>Edit
    Macro</strong>. This is useful as it provides autocompletion and
    other Komodo editing features.</li>
  </ol>

  <p>Refer to the <a href="macroapi.html#macroapi_top">Macro API</a>
  for information about writing JavaScript and Python macros in
  Komodo.</p>

  <h2><a name="macros_running" id="macros_running">Running Macros</a></h2>

  <p>To run the most recently recorded macro, select
  <strong>Tools|Macros|Execute Last Macro</strong>. If the Macro Toolbar
  is open (<strong>View|Toolbars|Macro</strong>), click <strong>Macro:
  Run Last Macro</strong>.</p>

  <p>To run a macro that has been saved to a <a
  href="project.html#project_top">project</a> or <a
  href="toolbox.html#toolbox_top">toolbox</a>, double-click the macro or
  use the key binding you have assigned to it. Alternatively,
  right-click the macro and select <strong>Execute Macro</strong>.</p>

  <h2><a name="macros_managing" id="macros_managing">Managing Macros</a></h2>

  <p>Macros can be dragged into any <a
  href="toolbox.html#toolbox_top">toolbox</a> or toolbox folder.
  Right-clicking on a macro brings up a context menu with the following
  additional options:</p>

  <ul>
    <li><strong>Execute Macro</strong>: Runs the selected macro.</li>
    
    <li><strong>Edit Macro</strong>: Opens the macro in an editor tab.</li>

    <li><strong>Cut/Copy/Paste</strong>: Used to duplicate or move a
    macro when dragging is not convenient (e.g. to a project which is
    currently closed).</li>

    <li><strong>Show in File Manager</strong>: Shows the JSON file for
    the macro in the system's default file manager.</li>

    <li><strong>Export as Zip File...</strong>: Exports the macro in a
    standard ".zip" archive.</li>

    <li><strong>Rename</strong>: Changes the macro name.</li>

    <li><strong>Delete</strong>: Permanently removes the selected macro
    from the toolbox.</li>
  </ul>

  <h2><a name="macros_properties">Macro Properties</a></h2>
  
  <p>Right-click on a macro and select <strong>Properties</strong> to
  view or edit the macro or configure the following properties.</p>
  
  <h3><a name="key_bindings" id="key_bindings">Assigning Key
  Bindings to Macros</a></h3>

  <p>Use the <strong>Key Binding</strong> tab to specify a key
  combination or sequence for invoking the macro. To add a new
  keybinding:</p>
  
  <ol>
    <li>Select the <strong>New Key Sequence</strong> field</li>
    <li>Press the desired key combinations. The <strong>Key Sequence
    Currently Used By</strong> field will alert you if there are any
    conflicts.</li>
    <li>Click <strong>Add</strong> (multiple keybindings are allowed).</li>
    <li>Click <strong>OK</strong> on the Properties dialog box to close
    it.</li>
  </ol>
  
  <p>If the macro is in a toolbox, the assigned keybinding will always
  trigger the macro. If it's in a project, the keybinding will work only
  when that project is open.</p>
  
  <h3><a name="Cust_Icons" id="Cust_Icons">Assigning Custom Icons
  to Macros</a></h3>

  <p>The default macro icon can be replaced with custom icons.
  Komodo includes more than 600 icons, but you can use any 16x16-pixel
  image you wish.</p>

  <p>To assign a custom icon to a macro:</p>

  <ol>
    <li>In the macro's Properties dialog box, click <strong>Change
    Icon</strong>.</li>

    <li>In the Pick an Icon dialog box, select an icon set from the drop
    list, choose a new icon, and click <strong>OK</strong>. To choose
    an icon from your filesystem, click <strong>Choose Other</strong>, and
    browse to the desired image file.</li>

    <li>Click <strong>OK</strong> on the Properties dialog box to close
    it. The custom icon is displayed next to the macro.</li>
  </ol>

  <p>To revert to the default icon for a selected macro, use the
  <strong>Reset</strong> button.</p>

  <h3><a name="run_background" id="run_background">Running Macros
  in the Background</a></h3>

  <p>Macros that invoke and do not affect the current file should be run
  in the background to minimize interference with Komodo responsiveness.
  Macros that run in the background are run in threads (Python), or in
  a timeout (JavaScript). To set this option:</p>

  <ol>
    <li>Right-click the macro in the Toolbox and select
    <strong>Properties</strong>.</li>

    <li>Select the <strong>Run in Background</strong> option.</li>

    <li>Click <strong>Apply</strong>.</li>
  </ol>
  
  <p>If a macro is not associated with a Komodo event, it can run either
  in the foreground or in the background.</p>
  
  <p>Macros that perform "editor" functions or modify open files should
  always run in the foreground to "block" and prevent user interference.
  This prevents the user from moving the cursor and disrupting the macro
  currently in progress.</p>

  <h3><a name="triggers_macros" id="triggers_macros">Specifying
  Macro Triggers</a></h3>

  <p>Macros can be configured to execute on certain Komodo events. When
  an event occurs (for example, a file is opened in Komodo), the macro
  is triggered.</p>

  <p>Check to make sure macro triggers are enabled in the <a
  href="prefs.html#projects">Projects and Workspace</a> preferences. In
  the <strong>Triggering Macros</strong> area, select <strong>Enable
  triggering of macros on Komodo events</strong>, and then click
  <strong>OK</strong>.</p>

  <p>To add a trigger to a macro:</p>

  <ol>
    <li>Select the <strong>Triggers</strong> tab on the Macro
    Properties dialog</li>
    <li>Select the <strong>Macro should trigger on a Komodo
        event</strong> check box.</li>
    
    <li>Choose one of the following triggers:
      <ul>
        <li>On startup (occurs at the end of the Komodo startup
        process)</li>

        <li>After file open</li>

        <li>Before file save (see <a href="#macros_return_values">Macro
        Return Values</a> below)</li>

        <li>After file save</li>

        <li>Before file close (see <a href="#macros_return_values">Macro
        Return Values</a> below)</li>

        <li>After file close</li>

        <li>On shutdown (see <a href="#macros_return_values">Macro
        Return Values</a> below)</li>
        
        <li>On a system notification</li>
      </ul>
    </li>
    <li>Set the <strong>Rank</strong> (optional): Enter a numerical rank
    for the macro. For example, if three macros all invoke "After a file
    is opened", a macro executes first (100), second (101), or third
    (102). The default is 100 to provide room for macros to run before
    the default (1-99). Note that if two macros trigger on the same
    event with the same rank, both execute in indeterminate order.</li>

    <li>Click <strong>Apply</strong>.</li>
  </ol>
  
  <h4><a name="macros_trigger_subject">Trigger Macro subject Variable</a></h4>
  
  <p>Trigger macros run with an argument called "subject", available as
  a global variable within the macro. This variable references the <a
  href="macroapi.html#macroapi_js">ko.views.manager.currentView
  object</a> for post-open, pre/post-save, and pre-close trigger macros.
  For post-close macros, it references the URI since the view object is
  empty at that point. For example, in a macro with an "After file open"
  trigger you could use:</p>
  
<pre class="code">
alert("Just opened file " + subject.document.displayPath);</pre> 
  

  <h4><a name="macros_return_values">Macro Return Values</a></h4>

  <p>Komodo macros that use the event triggers "Before file save",
  "Before file close", or "On shutdown", can make use of return values.
  Macros that return that return a true value (e.g. <code>True</code> in
  Python, <code>true</code> in JavaScript) can interrupt the process
  under execution. For example, the following JavaScript macro
  triggering "Before file save" prevents you from saving files on
  Sunday:</p>
  
<pre class="code">
var currentTime = new Date();
if (currentTime.getDay() == 7) {
  alert("Never on a Sunday!")
  return true;
}
else {
  return null;
}</pre>

  <h2><a name="vi_macros" id="vi_macros">Vi Command Mode
  Macros</a></h2>

  <p>Komodo's <a href="vikeybind.html#vi_emulation">Vi emulation</a>
  offers a command-line mode. Entering '<strong>:</strong>' opens a text
  box for entering commands. To access a macros from this mode, create a
  <a href= "toolbox.html">toolbox</a> folder named <strong>Vi
  Commands</strong> and move or copy the macro into it. Type the macro
  name in the Vi command text box to run it.</p>
  
  <hr />

</div> <!-- content -->
</body>
</html>
